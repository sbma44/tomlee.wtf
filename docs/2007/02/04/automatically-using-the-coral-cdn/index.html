<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>automatically using the coral cdn - Tom Lee</title>

    <meta name="description" content="You might've noticed that I hotlinked those mp3s, providing URLs that point directly at someone else's blog. This is normally considered pretty...">
    <meta name="robots" content="noindex, nofollow">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;600;700&family=Josefin+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="https://tomlee.wtf/theme/css/style.css">

    <link href="https://tomlee.wtf/feed.xml" type="application/atom+xml" rel="alternate" title="Tom Lee Atom Feed" />

    <script data-host="https://app.microanalytics.io" data-dnt="false" src="https://app.microanalytics.io/js/script.js" id="ZwSg9rf6GA" async defer></script>

</head>

<body>
    <header id="typology-header" class="typology-header">
        <div class="container">
            <div class="header-content">
                <div class="site-branding">
                    <h1 class="site-title"><a href="https://tomlee.wtf/">Tom Lee</a></h1>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="https://tomlee.wtf/">Home</a></li>
                        <li><a href="https://tomlee.wtf/search/">Search</a></li>
                        <!-- <li><a href="https://tomlee.wtf/about/">About</a></li>
                        <li><a href="https://tomlee.wtf/projects/">Projects</a></li> -->
                        <li class="social-icon"><a href="https://github.com/sbma44" target="_blank" rel="noopener" title="GitHub" aria-label="GitHub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                        </a></li>
                        <li class="social-icon"><a href="https://x.com/tjl" target="_blank" rel="noopener" title="Twitter" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                        </a></li>
                        <li class="social-icon"><a href="https://bsky.app/profile/tjl.bsky.social" target="_blank" rel="noopener" title="Bluesky" aria-label="Bluesky">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8z"/></svg>
                        </a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="typology-fake-bg">
<div class="typology-section">
    <div class="section-content">
        <article class="typology-post typology-single-post">
            <header class="entry-header" data-pagefind-ignore>
                <h1 class="entry-title" data-pagefind-meta="title">automatically using the coral cdn</h1>

                <div class="entry-meta">
                    <span class="meta-item">
                        <time datetime="2007-02-04T17:16:00-05:00" data-pagefind-meta="date">Sunday, 04 February 2007</time>
                        <span data-pagefind-filter="year" style="display: none;">2007</span>
                    </span>
                </div>

                <div class="post-letter">A</div>
            </header>

            <div class="entry-content" data-pagefind-body>
                <p>You might've noticed that I hotlinked those mp3s, providing URLs that point directly at someone else's blog. This is normally considered pretty poor form — you're using up someone else's bandwidth without giving them any associated (and salable) web traffic. But in this case it's not quite so bad: I used the Coral CDN to make the links. That reduces the bandwidth that my visitors will be consuming from the other sites to a negligible amount. NYU picks up most of the bill (and is presumably happy to do so). I wrote a bit more about the Coral CDN <a class="reference external" href="http://www.zunta.org/blog/archives/2005/03/29/ourmedia_sux0rs/">here</a>; you can find their explanation <a class="reference external" href="http://www.coralcdn.org/">here</a>. It's an extremely useful tool, and not just for excusing normally boorish behavior — if you have a large file on your own server, it can come in handy there, too.</p>
<p>The only downside is that it requires that users be able to send web traffic out on port [STRIKEOUT:8090] 8080, which is a slightly unusual requirement. It shouldn't be a problem for most people, but if someone's behind a restrictive corporate firewall, the Coral-ified link might make it impossible for them to get the file.</p>
<p>So to fix that I whipped up this Javascript. It attempts to load a small image (originating on this domain) over the Coral CDN. If it manages to, we know that the visitor can use port [STRIKEOUT:8090] 8080 and access the Coral system. If that condition is met, the script then replaces all the links on the page that go to big-seeming files with ones that use Coral (&quot;big-seeming&quot; is determined by the extension — mp3, mp4, mpg and avi are what the script looks for right now, but it's easy to adjust that). If the image doesn't load, the original link is left alone and will presumably still work for the poor firewalled visitor.</p>
<p>Here's the script:</p>
<blockquote>
<pre class="literal-block">
&lt;script type=&quot;text/javascript&quot;&gt;
function CoralizeLinks()
{
// modify the following line to adjust the extensions used by the function
var EXTENSION_MATCH_RE = new RegExp('\.(mp3|avi|mpg|mp4)$','i');
var x = new Image();
x.src = 'http://www.manifestdensity.net.nyud.net:8080/coral-test.gif';
x.onload = function()
{
var domain = location.href.replace(/http:\/\//i,'').replace(/\/.*$/,'');
var links = document.getElementsByTagName('a')
for(var i=0;i&lt;links.length;i++)
{
if((links[i].href.match(EXTENSION_MATCH_RE))&amp;&amp;(!(links[i].href.match(/\.nyud\.net:80[89]0/i))))
{
if(links[i].href.match(/^http:\/\//i))
links[i].href = links[i].href.replace(/http:\/\/(.*?)\/(.*)$/i,'http://$1.nyud.net:8080/$2');
else if(links[i].href.match(/^\//))
links[i].href = 'http://' + domain + '.nyud.net:8080' + links[i].href;
else
links[i].href = location.href.replace(/\/[^\/]+$/,'/').replace(domain,(domain+'.nyud.net:8080')) + links[i].href;
}
}
};
}
&lt;/script&gt;
</pre>
</blockquote>
<p>To use it on your page just save the file as &quot;coralize.js&quot; and upload it to your webserver. Add this to your template's &lt;head&gt; section:</p>
<blockquote>
<pre class="literal-block">
&lt;script type=&quot;text/javascript&quot; src=&quot;/path/to/coralize.js&quot;&gt;&lt;/script&gt;
</pre>
</blockquote>
<p>And modify your &lt;body&gt; tag like so:</p>
<blockquote>
<pre class="literal-block">
&lt;body onload=&quot;CoralizeLinks()&quot;&gt;
</pre>
</blockquote>
<p>There you go.</p>
<p>And, on an unrelated note, Peyton Manning's dad just said he sent his son a pre-game text message saying how proud he was. It's the future, even for old people!</p>
<p><strong>UPDATE:</strong> Looks like Coral switched to using port 8080 instead of 8090 a while ago (I have no idea why — they say they're going to <a class="reference external" href="http://wiki.coralcdn.org/wiki.php?n=Main.FAQ#highport">start using port 80</a> &quot;as soon as possible&quot;). Port 8090 appears to still work, but I've updated the script anyway. Also, the Coral people appear to use the verb &quot;coralize&quot; instead of &quot;coralify&quot;, and I've adjusted the script to reflect that, too.</p>

            </div>

        </article>
    </div>
</div>
    </div>

    <footer id="typology-footer" class="typology-footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy;  Tom Lee</p>
                <!-- <p>Powered by <a href="https://getpelican.com/" target="_blank" rel="noopener">Pelican</a></p> -->
            </div>
        </div>
    </footer>
</body>
</html>