<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>let's pick on a different mp3 aggregator for a change - Tom Lee</title>

    <meta name="description" content="The Hype Machine is great, but it's not the only one out there, after all. Besides, it's got certain shortcomings: its "popular" page is fine if...">
    <meta name="robots" content="noindex, nofollow">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;600;700&family=Josefin+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="https://tomlee.wtf/theme/css/style.css">

    <link href="https://tomlee.wtf/feed.xml" type="application/atom+xml" rel="alternate" title="Tom Lee Atom Feed" />

    <script data-host="https://app.microanalytics.io" data-dnt="false" src="https://app.microanalytics.io/js/script.js" id="ZwSg9rf6GA" async defer></script>

</head>

<body>
    <header id="typology-header" class="typology-header">
        <div class="container">
            <div class="header-content">
                <div class="site-branding">
                    <h1 class="site-title"><a href="https://tomlee.wtf/">Tom Lee</a></h1>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="https://tomlee.wtf/">Home</a></li>
                        <li><a href="https://tomlee.wtf/search/">Search</a></li>
                        <!-- <li><a href="https://tomlee.wtf/about/">About</a></li>
                        <li><a href="https://tomlee.wtf/projects/">Projects</a></li> -->
                        <li class="social-icon"><a href="https://github.com/sbma44" target="_blank" rel="noopener" title="GitHub" aria-label="GitHub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                        </a></li>
                        <li class="social-icon"><a href="https://x.com/tjl" target="_blank" rel="noopener" title="Twitter" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                        </a></li>
                        <li class="social-icon"><a href="https://bsky.app/profile/tjl.bsky.social" target="_blank" rel="noopener" title="Bluesky" aria-label="Bluesky">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8z"/></svg>
                        </a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="typology-fake-bg">
<div class="typology-section">
    <div class="section-content">
        <article class="typology-post typology-single-post">
            <header class="entry-header" data-pagefind-ignore>
                <h1 class="entry-title" data-pagefind-meta="title">let's pick on a different mp3 aggregator for a change</h1>

                <div class="entry-meta">
                    <span class="meta-item">
                        <time datetime="2007-11-26T16:14:00-05:00" data-pagefind-meta="date">Monday, 26 November 2007</time>
                        <span data-pagefind-filter="year" style="display: none;">2007</span>
                    </span>
                </div>

                <div class="post-letter">L</div>
            </header>

            <div class="entry-content" data-pagefind-body>
                <p>The Hype Machine is great, but it's not the only one out there, after all. Besides, it's got certain shortcomings: its &quot;popular&quot; page is fine if you want to listen to a ton of Bloc Party, but can suffer from a lack of variation. And looking at the front page is like drinking from a firehose. The <a class="reference external" href="/2007/11/23/everything-is-connected/">podcast feed that I made last week</a> suffers for it: you're not getting a representative snapshot of what's being talked about, but rather just a random sampling of what was popular when your copy of iTunes decided to check in. And, as I mentioned, the feed will no doubt be shut down by the HM guys (they may have already throttled iTunes' bandwidth).</p>
<p>So what about elbo.ws? They publish a <a class="reference external" href="http://elbo.ws/tracks">daily-updated list of popular tracks</a> that contains more music I haven't heard. And it's persistent enough that querying it once a day could be useful. The only problem is that it doesn't carry any MP3 links: users have to go hunting at the linked blogs to find links that are still alive. This makes it kind of a pain in the ass to check out the referenced music (and is why I generally prefer the Hype Machine).</p>
<p>But it <em>is</em> possible to create a podcast feed using techniques similar to the ones I applied to the Hype Machine. <a class="reference external" href="http://pipes.yahoo.com/sbma44/elbowspodcast">Here's</a> a pipe that simply retrieves the elbo.ws top tracks feed (or any other elbo.ws feed — it just defaults to that) and adds an enclosure tag to each entry. That tag tells iTunes (or whatever) to come talk to my server, passing the link associated with the elbo.ws entry.</p>
<p>At the server the request is intercepted via an .htaccess rewrite rule and redirected to a script (iTunes insists on URLs ending in .mp3, otherwise this would be unnecessary). The script pulls up the elbo.ws page and grabs the song name and listed blogs. It then loads the blogs and pulls out all of the MP3 links. From there it compares the link text to the collected song name and orders the results by similarity scores. Then it attempts to load each URL. For the first working one it finds it sends a redirect message to iTunes.</p>
<p>All this text processing and page-loading is pretty computationally expensive — it generally takes about half a minute to find a match — but with some caching it my server shouldn't be <em>completely</em> destroyed. An occasional incorrect match is returned, but overall I'm pretty pleased with the thing.</p>
<p>Here's the code for anyone interested. Given that this doesn't affect the elbo.ws folks' bandwidth or liability, I'm assuming they won't mind:</p>
<blockquote>
<pre class="literal-block">
&lt;?php
// taken from http://www.php.net/manual/en/function.file-exists.php#79118
function url_exists($url)
{
$handle   = curl_init($url);
if (false === $handle)
{
return false;
}
curl_setopt($handle, CURLOPT_HEADER, false);
curl_setopt($handle, CURLOPT_FAILONERROR, true);
curl_setopt($handle, CURLOPT_NOBODY, true);
curl_setopt($handle, CURLOPT_RETURNTRANSFER, false);
$connectable = curl_exec($handle);
curl_close($handle);
return $connectable;
}
function get_url($location)
{
$ch = curl_init($location);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Connection: close'));
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_TIMEOUT, 15);
$response = curl_exec($ch);
curl_close($ch);
return $response;
}
function usort_by_similarity($a,$b)
{
if($a['similarity']==$b['similarity'])
return 0;
else
return (($a['similarity']&gt;$b['similarity']) ? 1 : -1);
}
function get_mp3_link_uncached($elbows_url)
{
$blog_matches = array();
$elbows_page_id = preg_replace('/^.*#/','',$elbows_url);
$elbows_page_html = get_url($elbows_url);
$blog_links = array();
if(preg_match_all('/&lt;ul[^&gt;]*&gt;.*?&lt;\/ul&gt;/i',$elbows_page_html,$elbows_page_unordered_lists,PREG_SET_ORDER))
{
$matching_ul_html = '';
foreach($elbows_page_unordered_lists as $match)
{
if(stristr($match[0],$elbows_page_id))
$matching_ul_html .= $match[0];
}
preg_match_all('/href=[\'&quot;](.*?)[\'&quot;]/',$matching_ul_html,$blog_matches,PREG_SET_ORDER);
$song_name = $elbows_page_id;
if(preg_match_all('/&lt;h3[^&gt;]*&gt;(.*?)&lt;\/h3&gt;/',$elbows_page_html,$song_name_matches,PREG_SET_ORDER))
$song_name = $song_name_matches[0][1];
}
$matches_for_analysis = array();
foreach($blog_matches as $match)
{
// find all mp3 links on the blog page
$html = get_url($match[1]);
if(preg_match_all('/&lt;a[^&gt;]+href=[\'&quot;]([^\'&quot;]*?\.mp3)[\'&quot;][^&gt;]*&gt;(.*?)&lt;\s*\/a\s*&gt;/i',$html,$mp3_matches,PREG_SET_ORDER))
{
// retrieve the one with the most similar inner text and store it for more processing
$current_best_match = null;
foreach($mp3_matches as $mp3_match)
{
$l_similarity = levenshtein(substr($mp3_match[2],0,255), substr($song_name,0,255));
if((!is_array($current_best_match))||($current_best_match['similarity']&gt;$l_similarity))
{
$current_best_match = array(
'url' =&gt; $mp3_match[1],
'text' =&gt; $mp3_match[2],
'similarity' =&gt; $l_similarity,
);
}
}
if($current_best_match!=null)
{
$matches_for_analysis[] = array(
'url' =&gt; $current_best_match['url'],
'text' =&gt; $current_best_match['text'],
'similarity' =&gt; $current_best_match['similarity'],
);
}
}
}
// sort the matches list from all blogs to find the one with the most similar title
usort($matches_for_analysis,'usort_by_similarity');
for($i=0;$i&lt;sizeof($matches_for_analysis);$i++)
if(url_exists($matches_for_analysis[$i]['url']))
return $matches_for_analysis[$i]['url'];
}
if(isset($_GET['url']))
{
ini_set('max_execution_time',999999);
ini_set('include_path','.:/usr/lib/php:/usr/local/lib/php:/include:/home/metamon/php');
require_once('Cache/Function.php');
define('CACHE_EXPIRATION_IN_SECONDS',900);
$fcache = new Cache_Function('file', array('cache_dir' =&gt; './cache', 'filename_prefix' =&gt; 'fcache_elbows_'), CACHE_EXPIRATION_IN_SECONDS);
$mp3_url = $fcache-&gt;call('get_mp3_link_uncached',urldecode($_GET['url']));
header(&quot;HTTP/1.1 301 Moved Permanently&quot;);
header(&quot;Location: &quot; . $mp3_url);
exit();
}
?&gt;
</pre>
</blockquote>
<p>And the .htaccess looks like this:</p>
<blockquote>
<pre class="literal-block">
&lt;IfModule mod_rewrite.c&gt;
RewriteEngine on
RewriteRule ^.*\.mp3(.*)$ index.php$1 [L,QSA]
&lt;/IfModule&gt;
</pre>
</blockquote>
<p>I should add that I know none of this is new or mindblowing — projects like <a class="reference external" href="http://www.songbirdnest.com/">Songbird</a> are designed for exactly this sort of thing. But I like having my iPod automatically sync from one place, and I wanted to get at the elbo.ws feed specifically. Plus, y'know, it was fun to figure this out — it certainly taught me some things about the limits of Yahoo Pipes' JSON functionality.</p>

            </div>

        </article>
    </div>
</div>
    </div>

    <footer id="typology-footer" class="typology-footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy;  Tom Lee</p>
                <!-- <p>Powered by <a href="https://getpelican.com/" target="_blank" rel="noopener">Pelican</a></p> -->
            </div>
        </div>
    </footer>
</body>
</html>