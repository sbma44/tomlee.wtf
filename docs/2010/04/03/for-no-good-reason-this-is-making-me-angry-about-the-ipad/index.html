<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>for no good reason this is making me angry about the iPad - Tom Lee</title>

    <meta name="description" content="This will interest nobody, but I need to complain (and perhaps spare others some fruitless googling): the iPhone version of Safari seems to be...">
    <meta name="robots" content="noindex, nofollow">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;600;700&family=Josefin+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="https://tomlee.wtf/theme/css/style.css">

    <link href="https://tomlee.wtf/feed.xml" type="application/atom+xml" rel="alternate" title="Tom Lee Atom Feed" />

    <script data-host="https://app.microanalytics.io" data-dnt="false" src="https://app.microanalytics.io/js/script.js" id="ZwSg9rf6GA" async defer></script>

</head>

<body>
    <header id="typology-header" class="typology-header">
        <div class="container">
            <div class="header-content">
                <div class="site-branding">
                    <h1 class="site-title"><a href="https://tomlee.wtf/">Tom Lee</a></h1>
                </div>
                <nav class="main-nav">
                    <ul>
                        <!-- <li><a href="https://tomlee.wtf/">Home</a></li>
                        <li><a href="https://tomlee.wtf/about/">About</a></li>
                        <li><a href="https://tomlee.wtf/projects/">Projects</a></li> -->
                        <li class="social-icon"><a href="https://github.com/sbma44" target="_blank" rel="noopener" title="GitHub" aria-label="GitHub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                        </a></li>
                        <li class="social-icon"><a href="https://x.com/tjl" target="_blank" rel="noopener" title="Twitter" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                        </a></li>
                        <li class="social-icon"><a href="https://bsky.app/profile/tjl.bsky.social" target="_blank" rel="noopener" title="Bluesky" aria-label="Bluesky">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8z"/></svg>
                        </a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="typology-fake-bg">
<div class="typology-section">
    <div class="section-content">
        <article class="typology-post typology-single-post">
            <header class="entry-header">
                <h1 class="entry-title">for no good reason this is making me angry about the iPad</h1>

                <div class="entry-meta">
                    <span class="meta-item">
                        <time datetime="2010-04-03T14:17:00-04:00">Saturday, 03 April 2010</time>
                    </span>
                </div>

                <div class="post-letter">F</div>
            </header>

            <div class="entry-content">
                <p>This will interest nobody, but I need to complain (and perhaps spare others some fruitless googling): the iPhone version of Safari seems to be broken when using AJAX in offline caching in HTML5 applications.</p>
<p>&quot;Why would you want to use AJAX in an offline app?&quot; you ask, and it's a good question. Well, I'm trying to make an HTML5 interface to the <a class="reference external" href="http://sunlightlabs.com/blog/2010/our-door-opener-science-project/">office door-opening thingy</a>, because the native iPhone version, being a non-App Store offering, will be expiring soon in an irritating way (insert entirely different anti-Apple rant here).</p>
<p>Users will, of course, need network access to open the door. But I don't see any particular reason to make users download the 300-some-K of assets necessary to make a proper <a class="reference external" href="http://www.jqtouch.com/">jQTouch</a> iPhone app work every time they need to get into the office (or change their settings) -- particularly since I'm using a little onSuccess wav file (just for fun). So I set about using some offline caching to keep all that material decidedly on the iPhone, and not subject to the whims of Safari's caching policy.</p>
<p>This works fine until it's time to issue the request to open the door. The cache manifest file, which allows you to specify which items will be stored offline, allows for a whitelisted &quot;NETWORK&quot; section that will never be subject to the cache. Typically, you add your AJAX endpoint(s) to that section. Except in this case that AJAX request is made to a different domain than the one where the application lives (and when the application is being served from an offline cache who knows where it *thinks* it lives?), utilizing the now years-old-but-still-awfully-clever <a class="reference external" href="http://en.wikipedia.org/wiki/JSONP">JSONP</a> to escape the same-domain restrictions of a vanilla AJAX request.</p>
<p>This all works fine, <a class="reference external" href="http://stackoverflow.com/questions/1911614/how-do-i-avoid-having-jsonp-returns-cached-in-an-html5-offline-application/2572077">according to other people</a>. But not for me. My application's endpoint uses SSL in order to protect users' door-opening credentials, and that seems to make the difference. It just. doesn't. work. If you change the cache manifest, prompting the app to be reloaded, everything will work fine. Once. When you reload the app, pulling from the offline cache, the AJAX request produces a momentary activity indicator in the status bar, but there's no response. (No error, either! Thanks a bunch, Apple and/or jQuery.)</p>
<p>I've tried <a class="reference external" href="http://code.google.com/p/jqtouch/issues/detail?id=179">updating jQuery</a>. I've tried whitelisting &quot;*&quot;. I've tried whitelisting the http version of the endpoint, and just the path portion of the endpoint, and the full domain name of the endpoint (SSL and not). No dice.</p>
<p>Here's the relevant code, for anyone feeling particularly curious/masochistic. I've tried a lot of variations on it -- at this point I'm pretty sure that this aspect of iPhone Safari circa OS 3.1.2* is just broken. Ah well. No caching isn't the end of the world, but it is kind of annoying.</p>
<div class="line-block">
<div class="line">[cc lang=&quot;javascript&quot;]// I've tried it with and without the callback param (as I go back and forth between $.getJSON and $.ajax) -- doesn't make a difference</div>
<div class="line">var url = '<a class="reference external" href="https://gatekeeper.sunlightlabs.com/[SECRET]/api/?device_id=">https://gatekeeper.sunlightlabs.com/[SECRET]/api/?device_id=</a>' + localStorage.deviceID + '&amp;pin=' + PIN + '&amp;format=json&amp;callback=?';</div>
</div>
<div class="line-block">
<div class="line">$.ajax({</div>
<div class="line">url: url,</div>
<div class="line">dataType: 'jsonp',</div>
<div class="line">error: function(XMLHttpRequest, textStatus, errorThrown){</div>
<div class="line">alert(textStatus); // this never happens</div>
<div class="line">},</div>
<div class="line">success: function(data){</div>
<div class="line">localStorage.message = 'Welcome, ' + data.first_name + '!';</div>
<div class="line">localStorage.lastOpen = (new Date()).getTime();</div>
<div class="line">if(localStorage.disableSound=='on')</div>
<div class="line">{</div>
<div class="line">alert(localStorage.message);</div>
<div class="line">localStorage.message = '';</div>
<div class="line">}</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">location.href = 'zelda.wav'; // play the zelda door-opening music on success</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line">});[/cc]</div>
</div>
<p>* Gotta keep that tethering</p>

            </div>

        </article>
    </div>
</div>
    </div>

    <footer id="typology-footer" class="typology-footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy;  Tom Lee</p>
                <!-- <p>Powered by <a href="https://getpelican.com/" target="_blank" rel="noopener">Pelican</a></p> -->
            </div>
        </div>
    </footer>
</body>
</html>